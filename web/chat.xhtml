<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"    
      xmlns:f="http://xmlns.jcp.org/jsf/core" >

    <h:head>        
        <title>Chat</title>
       <link href="default.css" rel="stylesheet" type="text/css"></link>
    </h:head>
    
    <body>      
        <div id="wrapper">
            <div id="header-wrapper">
                <div id="header">
			<div id="logo">
				<h1><a href="#">DateRoulette</a></h1>
			</div>
		</div>
            </div>
            <div id="menu-wrapper">
		<div id="menu" >
                    <ul>
			<li><h:form><h:commandLink value="Ma page" action="profil.xhtml"></h:commandLink></h:form></li>
			<li><h:form><h:commandLink value="Contact" action="listeAmis.xhtml"></h:commandLink></h:form></li>
			<li><h:form><h:commandLink value="Messagerie" action="profil.xhtml"></h:commandLink></h:form></li>
                        <li><h:form><h:commandLink value="Deconnexion" action="#{sessionBean.deconnecter()}"></h:commandLink></h:form></li>	
                    </ul>
		</div>
		<!-- end #menu --> 
            </div>
      
            <h:form>

               <div id="page" class="container"> 
                 
                   <br/><h:outputText value="En discussion avec #{chatBean.correspondant}"
                                        style="font-weight: bold;"></h:outputText>
                   <!-- POPUP : QUITTER LE CHAT-->
                   <h:form>
                        <p style="float: right;"> 
                            <h:commandButton value="Quitter" onclick="confirmDialog.show()">
                            <f:ajax execute="@form" render="@none" />
                            </h:commandButton>

                            <p:confirmDialog id="confirmDialog" message="Voulez-vous vraiment quitter le chat ?" header="Quitter" severity="alert" widgetVar="confirmDialog">

                                <h:commandButton id="oui" value="Oui" actionListener="#{chatBean.quitterChat()}" action="profil?faces-redirect=true"/>

                                <h:commandButton id="non" value="Non" />

                            </p:confirmDialog>
                       </p>
                   </h:form>
                   <!-- FIN POPUP : QUITTER LE CHAT-->
                   <br/><br/>

                   <hr/>

                   <div id="chat" class="chat"></div>

                   <center>
                       <br/>
                       <h:inputTextarea id="message" value="#{chatBean.message}" rows="6" cols="75"></h:inputTextarea>

                       <!-- <br/><p:commandButton value="ENVOYER" actionListener="#{ChatBean.envoyerMessage}"/>-->
                       <h:commandButton value="Envoyer" action="#{chatBean.envoyerMessage()}">
                           <f:ajax execute="@form" render="@none" />
                       </h:commandButton>
                   </center>
                    
                   <hr/>
                   <p:remoteCommand name="nextEvent" actionListener="#{eventChatBean.lastEvent}" 
                                    oncomplete="updatePage(xhr, status, args);"/>
                   <!--<p:commandButton id="basic" value="Basic" onclick="PF('dlg1').show();" type="button" />  -->

                   <p:dialog id="basicDialog" header="Basic Dialog" widgetVar="dlg1">  
                         <h:outputText value="Resistance to PrimeFaces is futile!" />  
                   </p:dialog>
                   
                   <script type="text/javascript">    
                        updatePage(null,null,null);


                        function updatePage(xhr, status, args) {                
                            if (xhr != null)
                            {
                                if (args.ok)
                                {
                                    if (args.type == "message")
                                    {                            
                                        if(args.utilisateurCourant){
                                                $('#chat').append('<center><div class="msg"><span class = "receiver"><p>'+args.text+'</p></span></div></center><br/><br/>'); 
                                                $('#chat').append('<center><div class="msg"><span class = "receiverclock"><p style="font-size:smaller ;color : gray;">' +args.dateSent+'</p></span></div></center><br/><br/>');}
                                        if(!args.utilisateurCourant){
                                                $('#chat').append('<center><div class="msg"><span class = "sender"><p> '+args.text+'</p></span></div></center><br/><br/>' );
                                                $('#chat').append('<center><div class="msg"><span class = "senderclock"><p style="font-size:smaller ;color : gray;">' +args.dateSent+'</p></span></div></center><br/><br/>');}
                                    }
                                    if (args.type == "endChat")
                                    {
                                        alert("Ton pote veux plus te parler");
                                    }
                                    if (args.type == "utilDeco")
                                    {
                                        //alert("Ton pote c'est barr√©")
                                        //$('#decoDialog').show();
                                        //document.getElementById("prem:decoDialog").show();
                                        //document.getElementById('j_idt6:decoDialog').show();                        
                                    }
                                }                    
                            }
                            nextEvent();
                        } 
                </script> 

                </div>  
            </h:form>
        </div>
   
        <div id="footer-wrapper">
            <div id="footer">
		<ul>
                    <li><a href="#">CGU</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Contactez-nous</a></li>
		</ul>
            </div>
        </div>
    </body>
    
</html>
